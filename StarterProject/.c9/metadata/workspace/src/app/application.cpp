{"changed":true,"filter":false,"title":"application.cpp","tooltip":"/src/app/application.cpp","value":"\n#include \"version.h\"\n#include \"type.h\"\n#include \"define.h\"\n#include \"hw_gpio.h\"\n#include \"hw_uart.h\"\n\n#include \"hw_adc.h\"\n\n#include \"hw_ds1820.h\"\n#include \"hw_am2320.h\"\n\n#include \"hw_relay.h\"\n\n#include \"wdgHw.h\"\n\n#include \"networkTask.h\"\n\nstatic void gpio_intr_handler()\n{\n    uint32 gpio_status = GPIO_REG_READ(GPIO_STATUS_ADDRESS);\n\tGPIO_REG_WRITE(GPIO_STATUS_W1TC_ADDRESS, gpio_status);\n\n\t//m_printf(\"gpio_status:%X\\n\\r\",gpio_status);\n\n\tif (gpio_status & BIT(0))// S_REED\n\t{\n\t\tdebugf(\"irq00\\n\\r\");\n\t\t//GPIO_REG_WRITE(GPIO_STATUS_W1TC_ADDRESS, (gpio_status & BIT(0)));\n\t}\n\n\tif(gpio_status & BIT(3))//\n\t{\n    \tdebugf(\"irq03\\n\\r\");\n\t\t//GPIO_REG_WRITE(GPIO_STATUS_W1TC_ADDRESS, (gpio_status & BIT(3)));\n\t}\n\n\tif (gpio_status & BIT(4))//\n\t{\n \t\tdebugf(\"irq04\\n\\r\");\n \t\t\n \t\t_relay._changeStat();\n \t\t\n\t\t//GPIO_REG_WRITE(GPIO_STATUS_W1TC_ADDRESS, (gpio_status & BIT(4)));\n\t}\n\n\tif (gpio_status & BIT(13))//\n\t{\n\t\tdebugf(\"irq13\\n\\r\");\n\t\t//GPIO_REG_WRITE(GPIO_STATUS_W1TC_ADDRESS, (gpio_status & BIT(13)));\n\n\t\t_relay._changeStat();\n\t}\n\n\tif (gpio_status & BIT(15))\n\t{\n\t\tdebugf(\"irq15\\n\\r\");\n\t\t//GPIO_REG_WRITE(GPIO_STATUS_W1TC_ADDRESS, (gpio_status & BIT(13)));\n\t}\n}\n\n\nvoid irom connectCb()\n{\n\tdebugf(\"I'm CONNECTED\\n\");\n}\n\nvoid init()\n{\n\t_wdgHw._init();\n\tds1820.init();\n\n    ETS_GPIO_INTR_DISABLE();\n\n\t_gpio_init();\n\n    ETS_GPIO_INTR_ATTACH((void*)gpio_intr_handler, NULL);\n\n_uart0._conf(_BAUD_RATE_115200,_EIGHT_BITS,_TWO_STOP_BIT,_NONE_PARITY);\n\n\t// Config GPIO\n\t_gpio0._conf(_INTERRUPT,_PULL_NONE,_OFF,_INTR_POSEDGE);// S_REED\n\t//_gpio1._conf(_INPUT,_PULL_NONE,_OFF,_INTR_DISABLE);// TXD0\n\t_gpio2._conf(_INPUT,_PULL_NONE,_OFF,_INTR_DISABLE);//\n\t//_gpio3._conf(_INPUT,_PULL_NONE,_OFF,_INTR_DISABLE);// RXD0\n\t_gpioDtcNull._conf(_INPUT,_PULL_NONE,_OFF,_INTR_DISABLE);// DTC_NULL\n\t_gpio5._conf(_INPUT,_PULL_NONE,_OFF,_INTR_DISABLE);//\n\t_gpio12._conf(_INPUT,_PULL_NONE,_ON,_INTR_DISABLE);// TEMP-IO (DS1820)\n\t_gpioRelay._conf(_OUTPUT,_PULL_NONE,_OFF,_INTR_DISABLE);// CMD_RELAY\n\t_gpioAm2320._conf(_INPUT,_PULL_NONE,_OFF,_INTR_DISABLE);// TEMP-IO (AM2320)\n\t_gpio15._conf(_INPUT,_PULL_NONE,_OFF,_INTR_DISABLE);//\n_gpioWdg._conf(_OUTPUT,_PULL_NONE,_ON,_INTR_DISABLE);// WDG_H + LED\n\n\tSerial.systemDebugOutput(true);\n\n\t_wdgHw.start();\n\n\t// _fileSys._mountFileSystem();\n\n\t// _fileSys._readCalandarFile();\n\n\tWifiAccessPoint.enable(false);\n\tWifiStation.enable(true);\n\n\tWifiStation.config(WIFI_SSID, WIFI_PWD);\n\n#if IS_FIX_IP == 1\n\tIPAddress _ip;\n\t_ip = IPAddress(ADDR_IP_ESP);\n\tWifiStation.setIP(_ip);\n\t//WifiStation.enableDHCP(false);\n#endif\n\n\tWifiStation.waitConnection(connectCb);\n\t\n\n\n\tdebugf(\"\\n\\n\\n\");\n\tdebugf(\"\\r\\nVersion %s\\r\\n\", VERSION);\n\n\tint slot = rboot_get_current_rom();\n\tdebugf(\"\\r\\nCurrently running rom %d.\\r\\n\", slot);\n\n\t\n\n\tos_printf(\"restart system %s RADIATOR 0.0.0 %s\\n\\r\",VERSION,WifiStation.getMAC().c_str());\n\t\n\t//ds1820.start();\n\t\n\t_am2320._start();\n\n\t_adc._start();\n\t\n\tnetworkTask.start();\n}\n","undoManager":{"mark":64,"position":64,"stack":[[{"start":{"row":13,"column":10},"end":{"row":13,"column":21},"action":"remove","lines":["mainProcess"],"id":2},{"start":{"row":13,"column":10},"end":{"row":13,"column":11},"action":"insert","lines":["n"]}],[{"start":{"row":13,"column":11},"end":{"row":13,"column":12},"action":"insert","lines":["e"],"id":3}],[{"start":{"row":13,"column":12},"end":{"row":13,"column":13},"action":"insert","lines":["t"],"id":4}],[{"start":{"row":13,"column":13},"end":{"row":13,"column":14},"action":"insert","lines":["w"],"id":5}],[{"start":{"row":13,"column":14},"end":{"row":13,"column":15},"action":"insert","lines":["o"],"id":6}],[{"start":{"row":13,"column":15},"end":{"row":13,"column":16},"action":"insert","lines":["r"],"id":7}],[{"start":{"row":13,"column":16},"end":{"row":13,"column":17},"action":"insert","lines":["k"],"id":8}],[{"start":{"row":13,"column":17},"end":{"row":13,"column":18},"action":"insert","lines":["T"],"id":9}],[{"start":{"row":13,"column":18},"end":{"row":13,"column":19},"action":"insert","lines":["a"],"id":10}],[{"start":{"row":13,"column":19},"end":{"row":13,"column":20},"action":"insert","lines":["s"],"id":11}],[{"start":{"row":13,"column":20},"end":{"row":13,"column":21},"action":"insert","lines":["k"],"id":12}],[{"start":{"row":92,"column":8},"end":{"row":92,"column":9},"action":"remove","lines":["_"],"id":13}],[{"start":{"row":120,"column":7},"end":{"row":120,"column":8},"action":"remove","lines":["_"],"id":14}],[{"start":{"row":120,"column":1},"end":{"row":120,"column":6},"action":"remove","lines":["mainP"],"id":15},{"start":{"row":120,"column":1},"end":{"row":120,"column":12},"action":"insert","lines":["networkTask"]}],[{"start":{"row":120,"column":1},"end":{"row":120,"column":2},"action":"insert","lines":["/"],"id":16}],[{"start":{"row":120,"column":2},"end":{"row":120,"column":3},"action":"insert","lines":["/"],"id":17}],[{"start":{"row":120,"column":1},"end":{"row":120,"column":2},"action":"remove","lines":["/"],"id":18}],[{"start":{"row":120,"column":1},"end":{"row":120,"column":2},"action":"remove","lines":["/"],"id":19}],[{"start":{"row":118,"column":91},"end":{"row":119,"column":0},"action":"insert","lines":["",""],"id":20},{"start":{"row":119,"column":0},"end":{"row":119,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":119,"column":1},"end":{"row":120,"column":0},"action":"insert","lines":["",""],"id":21},{"start":{"row":120,"column":0},"end":{"row":120,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":120,"column":1},"end":{"row":122,"column":15},"action":"insert","lines":["\tds1820.start();","","\t_adc._start();"],"id":22}],[{"start":{"row":120,"column":1},"end":{"row":120,"column":2},"action":"remove","lines":["\t"],"id":23}],[{"start":{"row":5,"column":20},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":24}],[{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":25}],[{"start":{"row":7,"column":0},"end":{"row":10,"column":22},"action":"insert","lines":["","#include \"hw_adc.h\"","","#include \"hw_ds1820.h\""],"id":26}],[{"start":{"row":10,"column":0},"end":{"row":10,"column":22},"action":"remove","lines":["#include \"hw_ds1820.h\""],"id":27}],[{"start":{"row":9,"column":0},"end":{"row":10,"column":0},"action":"remove","lines":["",""],"id":28}],[{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"remove","lines":["",""],"id":29}],[{"start":{"row":113,"column":39},"end":{"row":114,"column":0},"action":"insert","lines":["",""],"id":30},{"start":{"row":114,"column":0},"end":{"row":114,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":114,"column":1},"end":{"row":115,"column":0},"action":"insert","lines":["",""],"id":31},{"start":{"row":115,"column":0},"end":{"row":115,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":115,"column":0},"end":{"row":115,"column":13},"action":"insert","lines":["RBOOT_ENABLED"],"id":32}],[{"start":{"row":115,"column":0},"end":{"row":115,"column":1},"action":"insert","lines":["#"],"id":33}],[{"start":{"row":115,"column":1},"end":{"row":115,"column":2},"action":"insert","lines":["i"],"id":34}],[{"start":{"row":115,"column":2},"end":{"row":115,"column":3},"action":"insert","lines":["f"],"id":35}],[{"start":{"row":115,"column":3},"end":{"row":115,"column":4},"action":"insert","lines":[" "],"id":36}],[{"start":{"row":117,"column":36},"end":{"row":118,"column":0},"action":"insert","lines":["",""],"id":37},{"start":{"row":118,"column":0},"end":{"row":118,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":118,"column":1},"end":{"row":119,"column":0},"action":"insert","lines":["",""],"id":38},{"start":{"row":119,"column":0},"end":{"row":119,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":119,"column":1},"end":{"row":119,"column":18},"action":"insert","lines":["#if RBOOT_ENABLED"],"id":39}],[{"start":{"row":119,"column":0},"end":{"row":119,"column":1},"action":"remove","lines":["\t"],"id":40}],[{"start":{"row":119,"column":0},"end":{"row":119,"column":17},"action":"remove","lines":["#if RBOOT_ENABLED"],"id":41},{"start":{"row":119,"column":0},"end":{"row":119,"column":6},"action":"insert","lines":["#endif"]}],[{"start":{"row":122,"column":39},"end":{"row":123,"column":0},"action":"insert","lines":["",""],"id":42},{"start":{"row":123,"column":0},"end":{"row":123,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":123,"column":1},"end":{"row":124,"column":0},"action":"insert","lines":["",""],"id":43},{"start":{"row":124,"column":0},"end":{"row":124,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":115,"column":18},"end":{"row":116,"column":0},"action":"remove","lines":["",""],"id":44}],[{"start":{"row":116,"column":36},"end":{"row":117,"column":1},"action":"remove","lines":["","\t"],"id":45}],[{"start":{"row":115,"column":0},"end":{"row":117,"column":6},"action":"remove","lines":["#if RBOOT_ENABLED\t","\tint slot = rboot_get_current_rom();","#endif"],"id":46}],[{"start":{"row":120,"column":0},"end":{"row":122,"column":6},"action":"insert","lines":["#if RBOOT_ENABLED\t","\tint slot = rboot_get_current_rom();","#endif"],"id":47}],[{"start":{"row":123,"column":1},"end":{"row":123,"column":51},"action":"remove","lines":["debugf(\"\\r\\nCurrently running rom %d.\\r\\n\", slot);"],"id":48}],[{"start":{"row":121,"column":36},"end":{"row":122,"column":0},"action":"insert","lines":["",""],"id":49},{"start":{"row":122,"column":0},"end":{"row":122,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":122,"column":1},"end":{"row":122,"column":51},"action":"insert","lines":["debugf(\"\\r\\nCurrently running rom %d.\\r\\n\", slot);"],"id":50}],[{"start":{"row":123,"column":0},"end":{"row":123,"column":7},"action":"remove","lines":["#endif\t"],"id":51}],[{"start":{"row":119,"column":0},"end":{"row":120,"column":18},"action":"remove","lines":["\t","#if RBOOT_ENABLED\t"],"id":52}],[{"start":{"row":127,"column":1},"end":{"row":127,"column":2},"action":"insert","lines":["/"],"id":53}],[{"start":{"row":127,"column":2},"end":{"row":127,"column":3},"action":"insert","lines":["/"],"id":54}],[{"start":{"row":127,"column":18},"end":{"row":128,"column":0},"action":"insert","lines":["",""],"id":55},{"start":{"row":128,"column":0},"end":{"row":128,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":128,"column":1},"end":{"row":129,"column":0},"action":"insert","lines":["",""],"id":56},{"start":{"row":129,"column":0},"end":{"row":129,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":129,"column":1},"end":{"row":129,"column":8},"action":"insert","lines":["_am2320"],"id":57}],[{"start":{"row":129,"column":8},"end":{"row":129,"column":9},"action":"insert","lines":["."],"id":58}],[{"start":{"row":129,"column":9},"end":{"row":129,"column":10},"action":"insert","lines":["s"],"id":59}],[{"start":{"row":129,"column":10},"end":{"row":129,"column":11},"action":"insert","lines":["t"],"id":60}],[{"start":{"row":129,"column":11},"end":{"row":129,"column":12},"action":"insert","lines":["a"],"id":61}],[{"start":{"row":129,"column":12},"end":{"row":129,"column":13},"action":"insert","lines":["r"],"id":62}],[{"start":{"row":129,"column":13},"end":{"row":129,"column":14},"action":"insert","lines":["t"],"id":63}],[{"start":{"row":129,"column":14},"end":{"row":129,"column":16},"action":"insert","lines":["()"],"id":64}],[{"start":{"row":129,"column":16},"end":{"row":129,"column":17},"action":"insert","lines":[";"],"id":65}],[{"start":{"row":129,"column":9},"end":{"row":129,"column":10},"action":"insert","lines":["_"],"id":66}],[{"start":{"row":125,"column":1},"end":{"row":125,"column":10},"action":"remove","lines":["os_printf"],"id":67},{"start":{"row":125,"column":1},"end":{"row":125,"column":7},"action":"insert","lines":["debugf"]}]]},"ace":{"folds":[],"scrolltop":1297.7993469238281,"scrollleft":0,"selection":{"start":{"row":106,"column":4},"end":{"row":106,"column":13},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1474570644961}