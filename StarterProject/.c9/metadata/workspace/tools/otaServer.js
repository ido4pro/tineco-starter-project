{"filter":false,"title":"otaServer.js","tooltip":"/tools/otaServer.js","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":70,"column":17},"end":{"row":70,"column":18},"action":"remove","lines":["d"],"id":42}],[{"start":{"row":70,"column":17},"end":{"row":70,"column":18},"action":"insert","lines":["D"],"id":43}],[{"start":{"row":2,"column":3},"end":{"row":3,"column":0},"action":"insert","lines":["",""],"id":44},{"start":{"row":3,"column":0},"end":{"row":3,"column":1},"action":"insert","lines":[" "]}],[{"start":{"row":3,"column":1},"end":{"row":4,"column":0},"action":"insert","lines":["",""],"id":45},{"start":{"row":4,"column":0},"end":{"row":4,"column":1},"action":"insert","lines":[" "]}],[{"start":{"row":4,"column":1},"end":{"row":5,"column":0},"action":"insert","lines":["",""],"id":46},{"start":{"row":5,"column":0},"end":{"row":5,"column":1},"action":"insert","lines":[" "]}],[{"start":{"row":5,"column":1},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":47},{"start":{"row":6,"column":0},"end":{"row":6,"column":1},"action":"insert","lines":[" "]}],[{"start":{"row":6,"column":1},"end":{"row":28,"column":3},"action":"insert","lines":["var data = fs.readFileSync('./include/define.h');","//var data = fs.readFileSync('../include/version.h');","","var lines = data.toString().split(/(?:\\n|\\r\\n|\\r)/g);","","var deviceid;","var serverUrl;","","lines.forEach(function(line)","{","    if(line.lastIndexOf('#define DEVICE_ID', 0) === 0)","    {","        deviceid = sscanf(line,'#define DEVICE_ID \\\"%s\\\"');","    }","    else if(line.lastIndexOf('#define SERVER_URL', 0) === 0)","    {","        serverUrl = sscanf(line,'#define SERVER_URL \\\"%s\\\"');","    }","","","","","});"],"id":48}],[{"start":{"row":23,"column":5},"end":{"row":24,"column":0},"action":"remove","lines":["",""],"id":49}],[{"start":{"row":23,"column":5},"end":{"row":24,"column":0},"action":"remove","lines":["",""],"id":50}],[{"start":{"row":23,"column":5},"end":{"row":24,"column":0},"action":"remove","lines":["",""],"id":51}],[{"start":{"row":23,"column":5},"end":{"row":24,"column":0},"action":"remove","lines":["",""],"id":52}],[{"start":{"row":5,"column":1},"end":{"row":5,"column":38},"action":"insert","lines":["var sscanf = require('scanf').sscanf;"],"id":53}],[{"start":{"row":5,"column":0},"end":{"row":5,"column":3},"action":"insert","lines":["// "],"id":54},{"start":{"row":6,"column":0},"end":{"row":6,"column":3},"action":"insert","lines":["// "]},{"start":{"row":7,"column":0},"end":{"row":7,"column":3},"action":"insert","lines":["// "]},{"start":{"row":9,"column":0},"end":{"row":9,"column":3},"action":"insert","lines":["// "]},{"start":{"row":11,"column":0},"end":{"row":11,"column":3},"action":"insert","lines":["// "]},{"start":{"row":12,"column":0},"end":{"row":12,"column":3},"action":"insert","lines":["// "]},{"start":{"row":14,"column":0},"end":{"row":14,"column":3},"action":"insert","lines":["// "]},{"start":{"row":15,"column":0},"end":{"row":15,"column":3},"action":"insert","lines":["// "]},{"start":{"row":16,"column":0},"end":{"row":16,"column":3},"action":"insert","lines":["// "]},{"start":{"row":17,"column":0},"end":{"row":17,"column":3},"action":"insert","lines":["// "]},{"start":{"row":18,"column":0},"end":{"row":18,"column":3},"action":"insert","lines":["// "]},{"start":{"row":19,"column":0},"end":{"row":19,"column":3},"action":"insert","lines":["// "]},{"start":{"row":20,"column":0},"end":{"row":20,"column":3},"action":"insert","lines":["// "]},{"start":{"row":21,"column":0},"end":{"row":21,"column":3},"action":"insert","lines":["// "]},{"start":{"row":22,"column":0},"end":{"row":22,"column":3},"action":"insert","lines":["// "]},{"start":{"row":23,"column":0},"end":{"row":23,"column":3},"action":"insert","lines":["// "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":3},"action":"insert","lines":["// "]}],[{"start":{"row":80,"column":3},"end":{"row":81,"column":0},"action":"insert","lines":["",""],"id":55},{"start":{"row":81,"column":0},"end":{"row":81,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":81,"column":2},"end":{"row":82,"column":0},"action":"insert","lines":["",""],"id":56},{"start":{"row":82,"column":0},"end":{"row":82,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":82,"column":2},"end":{"row":82,"column":15},"action":"insert","lines":["var deviceid "],"id":57}],[{"start":{"row":82,"column":14},"end":{"row":82,"column":15},"action":"remove","lines":[" "],"id":58}],[{"start":{"row":82,"column":14},"end":{"row":82,"column":15},"action":"insert","lines":[";"],"id":59}],[{"start":{"row":82,"column":0},"end":{"row":82,"column":15},"action":"remove","lines":["  var deviceid;"],"id":64}],[{"start":{"row":80,"column":3},"end":{"row":81,"column":2},"action":"remove","lines":["","  "],"id":65}],[{"start":{"row":80,"column":3},"end":{"row":81,"column":0},"action":"remove","lines":["",""],"id":66}],[{"start":{"row":5,"column":0},"end":{"row":5,"column":3},"action":"remove","lines":["// "],"id":67},{"start":{"row":6,"column":0},"end":{"row":6,"column":3},"action":"remove","lines":["// "]},{"start":{"row":7,"column":0},"end":{"row":7,"column":3},"action":"remove","lines":["// "]},{"start":{"row":9,"column":0},"end":{"row":9,"column":3},"action":"remove","lines":["// "]},{"start":{"row":11,"column":0},"end":{"row":11,"column":3},"action":"remove","lines":["// "]},{"start":{"row":12,"column":0},"end":{"row":12,"column":3},"action":"remove","lines":["// "]},{"start":{"row":14,"column":0},"end":{"row":14,"column":3},"action":"remove","lines":["// "]},{"start":{"row":15,"column":0},"end":{"row":15,"column":3},"action":"remove","lines":["// "]},{"start":{"row":16,"column":0},"end":{"row":16,"column":3},"action":"remove","lines":["// "]},{"start":{"row":17,"column":0},"end":{"row":17,"column":3},"action":"remove","lines":["// "]},{"start":{"row":18,"column":0},"end":{"row":18,"column":3},"action":"remove","lines":["// "]},{"start":{"row":19,"column":0},"end":{"row":19,"column":3},"action":"remove","lines":["// "]},{"start":{"row":20,"column":0},"end":{"row":20,"column":3},"action":"remove","lines":["// "]},{"start":{"row":21,"column":0},"end":{"row":21,"column":3},"action":"remove","lines":["// "]},{"start":{"row":22,"column":0},"end":{"row":22,"column":3},"action":"remove","lines":["// "]},{"start":{"row":23,"column":0},"end":{"row":23,"column":3},"action":"remove","lines":["// "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":3},"action":"remove","lines":["// "]}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":53},"action":"remove","lines":["//var data = fs.readFileSync('../include/version.h');"],"id":68}],[{"start":{"row":7,"column":0},"end":{"row":8,"column":0},"action":"remove","lines":["",""],"id":69}],[{"start":{"row":160,"column":22},"end":{"row":160,"column":36},"action":"remove","lines":["device.shortId"],"id":70},{"start":{"row":160,"column":22},"end":{"row":160,"column":30},"action":"insert","lines":["deviceid"]}],[{"start":{"row":159,"column":13},"end":{"row":160,"column":32},"action":"remove","lines":[" res.writeHead(200, {'Content-Type': 'text/plain'});","              res.end(deviceid);"],"id":71}],[{"start":{"row":130,"column":3},"end":{"row":182,"column":26},"action":"remove","lines":[" app.models.smartBuilding.checkIp(externalIp,function(err,smartBuilding)","    {","      console.log('smartBuilding=', smartBuilding);","","        if(smartBuilding)","        {","","          var infoDevice = req.body;","          infoDevice.externalIp = externalIp;","          infoDevice.smartBuildingId = smartBuilding._id.toString();","          infoDevice.smartBuildingLabel = smartBuilding.name;","          infoDevice.customerId = smartBuilding.customerId;","","          app.models.device.isExist(infoDevice,function(err,device)","          {","","","            if(device)","            {","              console.log('device found=',device.shortId);","","              app.models.device.updateDate(device.shortId,function(err,r)","              {","                if(err)","                {","                  console.log('err=', err);","                }","              });","","             ","            }","            else","            {","              console.log('Need to be create:',infoDevice);","              res.sendStatus(403);","            }","","          });","        }","      else","        {","","          console.log('Network not found');","","          res.sendStatus(503);","","        }","    });","","","","","    //res.sendStatus(200);"],"id":79},{"start":{"row":130,"column":3},"end":{"row":131,"column":22},"action":"insert","lines":["    res.writeHead(200, {'Content-Type': 'text/plain'});","    res.end(deviceid);"]}],[{"start":{"row":130,"column":6},"end":{"row":130,"column":7},"action":"remove","lines":[" "],"id":80}],[{"start":{"row":130,"column":5},"end":{"row":130,"column":6},"action":"remove","lines":[" "],"id":81}],[{"start":{"row":130,"column":4},"end":{"row":130,"column":5},"action":"remove","lines":[" "],"id":82}],[{"start":{"row":32,"column":2},"end":{"row":32,"column":25},"action":"remove","lines":["var fs = require('fs');"],"id":83}],[{"start":{"row":5,"column":38},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":84},{"start":{"row":6,"column":0},"end":{"row":6,"column":1},"action":"insert","lines":[" "]}],[{"start":{"row":6,"column":1},"end":{"row":6,"column":24},"action":"insert","lines":["var fs = require('fs');"],"id":85}],[{"start":{"row":7,"column":30},"end":{"row":7,"column":31},"action":"insert","lines":["."],"id":86}],[{"start":{"row":7,"column":29},"end":{"row":7,"column":44},"action":"insert","lines":["/opt/workspace/"],"id":87}],[{"start":{"row":7,"column":44},"end":{"row":7,"column":45},"action":"insert","lines":["s"],"id":88}],[{"start":{"row":7,"column":45},"end":{"row":7,"column":46},"action":"insert","lines":["r"],"id":89}],[{"start":{"row":7,"column":46},"end":{"row":7,"column":47},"action":"insert","lines":["c"],"id":90}],[{"start":{"row":7,"column":47},"end":{"row":7,"column":48},"action":"remove","lines":["."],"id":91}],[{"start":{"row":7,"column":47},"end":{"row":7,"column":48},"action":"remove","lines":["."],"id":92}],[{"start":{"row":125,"column":28},"end":{"row":125,"column":33},"action":"remove","lines":[".body"],"id":93}],[{"start":{"row":27,"column":20},"end":{"row":28,"column":0},"action":"insert","lines":["",""],"id":94}],[{"start":{"row":28,"column":0},"end":{"row":29,"column":0},"action":"insert","lines":["",""],"id":95}],[{"start":{"row":29,"column":0},"end":{"row":31,"column":77},"action":"insert","lines":["var bodyParser = require('body-parser');","app.use(bodyParser.json()); // support json encoded bodies","app.use(bodyParser.urlencoded({ extended: true })); // support encoded bodies"],"id":96}],[{"start":{"row":129,"column":28},"end":{"row":129,"column":29},"action":"insert","lines":["."],"id":97}],[{"start":{"row":129,"column":29},"end":{"row":129,"column":30},"action":"insert","lines":["b"],"id":98}],[{"start":{"row":129,"column":30},"end":{"row":129,"column":31},"action":"insert","lines":["o"],"id":99}],[{"start":{"row":129,"column":31},"end":{"row":129,"column":32},"action":"insert","lines":["d"],"id":100}],[{"start":{"row":129,"column":32},"end":{"row":129,"column":33},"action":"insert","lines":["y"],"id":101}],[{"start":{"row":42,"column":35},"end":{"row":43,"column":0},"action":"insert","lines":["",""],"id":102},{"start":{"row":43,"column":0},"end":{"row":43,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":43,"column":4},"end":{"row":44,"column":0},"action":"insert","lines":["",""],"id":103},{"start":{"row":44,"column":0},"end":{"row":44,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":44,"column":4},"end":{"row":44,"column":5},"action":"insert","lines":["c"],"id":104}],[{"start":{"row":44,"column":5},"end":{"row":44,"column":6},"action":"insert","lines":["o"],"id":105}],[{"start":{"row":44,"column":6},"end":{"row":44,"column":7},"action":"insert","lines":["n"],"id":106}],[{"start":{"row":44,"column":7},"end":{"row":44,"column":8},"action":"insert","lines":["s"],"id":107}],[{"start":{"row":44,"column":8},"end":{"row":44,"column":9},"action":"insert","lines":["o"],"id":108}],[{"start":{"row":44,"column":9},"end":{"row":44,"column":10},"action":"insert","lines":["l"],"id":109}],[{"start":{"row":44,"column":10},"end":{"row":44,"column":11},"action":"insert","lines":["e"],"id":110}],[{"start":{"row":44,"column":11},"end":{"row":44,"column":12},"action":"insert","lines":["."],"id":111}],[{"start":{"row":44,"column":12},"end":{"row":44,"column":13},"action":"insert","lines":["l"],"id":112}],[{"start":{"row":44,"column":13},"end":{"row":44,"column":14},"action":"insert","lines":["o"],"id":113}],[{"start":{"row":44,"column":14},"end":{"row":44,"column":15},"action":"insert","lines":["g"],"id":114}],[{"start":{"row":44,"column":15},"end":{"row":44,"column":17},"action":"insert","lines":["()"],"id":115}],[{"start":{"row":44,"column":16},"end":{"row":44,"column":18},"action":"insert","lines":["''"],"id":116}],[{"start":{"row":44,"column":17},"end":{"row":44,"column":18},"action":"insert","lines":["e"],"id":117}],[{"start":{"row":44,"column":18},"end":{"row":44,"column":19},"action":"insert","lines":["q"],"id":118}],[{"start":{"row":44,"column":18},"end":{"row":44,"column":19},"action":"remove","lines":["q"],"id":119}],[{"start":{"row":44,"column":17},"end":{"row":44,"column":18},"action":"remove","lines":["e"],"id":120}],[{"start":{"row":44,"column":17},"end":{"row":44,"column":18},"action":"insert","lines":["r"],"id":121}],[{"start":{"row":44,"column":18},"end":{"row":44,"column":19},"action":"insert","lines":["e"],"id":122}],[{"start":{"row":44,"column":19},"end":{"row":44,"column":20},"action":"insert","lines":["q"],"id":123}],[{"start":{"row":44,"column":20},"end":{"row":44,"column":21},"action":"insert","lines":["."],"id":124}],[{"start":{"row":44,"column":21},"end":{"row":44,"column":22},"action":"insert","lines":["h"],"id":125}],[{"start":{"row":44,"column":22},"end":{"row":44,"column":23},"action":"insert","lines":["e"],"id":126}],[{"start":{"row":44,"column":23},"end":{"row":44,"column":24},"action":"insert","lines":["a"],"id":127}],[{"start":{"row":44,"column":24},"end":{"row":44,"column":25},"action":"insert","lines":["d"],"id":128}],[{"start":{"row":44,"column":25},"end":{"row":44,"column":26},"action":"insert","lines":["e"],"id":129}],[{"start":{"row":44,"column":26},"end":{"row":44,"column":27},"action":"insert","lines":["r"],"id":130}],[{"start":{"row":44,"column":27},"end":{"row":44,"column":28},"action":"insert","lines":["s"],"id":131}],[{"start":{"row":44,"column":28},"end":{"row":44,"column":29},"action":"insert","lines":["="],"id":132}],[{"start":{"row":44,"column":30},"end":{"row":44,"column":31},"action":"insert","lines":[","],"id":133}],[{"start":{"row":44,"column":31},"end":{"row":44,"column":32},"action":"insert","lines":["r"],"id":134}],[{"start":{"row":44,"column":32},"end":{"row":44,"column":33},"action":"insert","lines":["e"],"id":135}],[{"start":{"row":44,"column":33},"end":{"row":44,"column":34},"action":"insert","lines":["q"],"id":136}],[{"start":{"row":44,"column":34},"end":{"row":44,"column":35},"action":"insert","lines":["."],"id":137}],[{"start":{"row":44,"column":35},"end":{"row":44,"column":36},"action":"insert","lines":["h"],"id":138}],[{"start":{"row":44,"column":36},"end":{"row":44,"column":37},"action":"insert","lines":["e"],"id":139}],[{"start":{"row":44,"column":35},"end":{"row":44,"column":37},"action":"remove","lines":["he"],"id":140},{"start":{"row":44,"column":35},"end":{"row":44,"column":42},"action":"insert","lines":["headers"]}],[{"start":{"row":110,"column":4},"end":{"row":111,"column":0},"action":"insert","lines":["",""],"id":141},{"start":{"row":111,"column":0},"end":{"row":111,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":111,"column":4},"end":{"row":112,"column":0},"action":"insert","lines":["",""],"id":142},{"start":{"row":112,"column":0},"end":{"row":112,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":110,"column":4},"end":{"row":110,"column":24},"action":"insert","lines":["#include \"version.h\""],"id":143}],[{"start":{"row":110,"column":4},"end":{"row":110,"column":24},"action":"remove","lines":["#include \"version.h\""],"id":144},{"start":{"row":110,"column":4},"end":{"row":110,"column":50},"action":"insert","lines":["console.log('Receive rom file for ',deviceid);"]}],[{"start":{"row":110,"column":17},"end":{"row":110,"column":24},"action":"remove","lines":["Receive"],"id":145},{"start":{"row":110,"column":17},"end":{"row":110,"column":18},"action":"insert","lines":["A"]}],[{"start":{"row":110,"column":18},"end":{"row":110,"column":19},"action":"insert","lines":["s"],"id":146}],[{"start":{"row":110,"column":19},"end":{"row":110,"column":20},"action":"insert","lines":["k"],"id":147}],[{"start":{"row":110,"column":4},"end":{"row":110,"column":46},"action":"remove","lines":["console.log('Ask rom file for ',deviceid);"],"id":148}],[{"start":{"row":110,"column":4},"end":{"row":111,"column":4},"action":"remove","lines":["","    "],"id":149}],[{"start":{"row":111,"column":39},"end":{"row":112,"column":0},"action":"insert","lines":["",""],"id":150},{"start":{"row":112,"column":0},"end":{"row":112,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":112,"column":4},"end":{"row":113,"column":0},"action":"insert","lines":["",""],"id":151},{"start":{"row":113,"column":0},"end":{"row":113,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":113,"column":4},"end":{"row":113,"column":46},"action":"insert","lines":["console.log('Ask rom file for ',deviceid);"],"id":152}],[{"start":{"row":122,"column":40},"end":{"row":122,"column":49},"action":"remove","lines":["'../../'+"],"id":153}]]},"ace":{"folds":[],"scrolltop":1490.4990997314453,"scrollleft":0,"selection":{"start":{"row":122,"column":40},"end":{"row":122,"column":40},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":91,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1474485527688,"hash":"5d15a141b975889a3c831e0d96891914d20a85d9"}